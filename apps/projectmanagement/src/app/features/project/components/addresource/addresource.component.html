<div class="justify-between mb-3" nz-row>
  <div class="tab-title"> Resources </div>

  <div>
    <button [ngClass]="isOnEditstate ? 'btn mr-4':'btn'" (click)="showModal()">
      Assign resource
    </button>

    <button *ngIf="isOnEditstate"  (click)="showConfirm()" class="btn-cancel ">
      Cancel
    </button>

  </div>

</div>

<nz-table nzSize="small"  [nzBordered]="false" [nzFrontPagination]="false" [nzData]="projectResources" nzTableLayout="fixed">
  <thead>
    <tr>
      <th>Resource</th>
      <th>Assigned Date</th>
      <th>Action</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let resource of projectResources">
      <td>
        {{ resource.Empolyee?.Name | titlecase }} - {{ resource.Empolyee?.Role }}
      </td>
      <td>{{ resource.AssignDate | date: 'shortDate' }}</td>

      <td>
        <a class="text-black mr-3" (click)="editResource(resource.Empolyee.Guid)">
          <i nz-icon nzType="edit" style="color:black;"></i>
        </a>
        &nbsp; &nbsp;
        <a class="text-black" *ngIf="!isOnEditstate" (click)="removeForAddReource(resource)" >
          <i nz-icon nzType="delete" style="color: black"></i>
        </a>
        <a class="text-black" *ngIf="isOnEditstate" (click)="conformationDelete(resource)">
          <i nz-icon nzType="delete" style="color: black"></i>
        </a>
      </td>
    </tr>
  </tbody>
</nz-table>

<nz-modal class="resourceModal"  class="p-28" [(nzVisible)]="isModalVisible" nzTitle="Assign Resource"
  (nzOnCancel)="handleCancel()" [nzFooter]="null">
  <ng-container *nzModalContent>
    <form *ngIf="!isEditMode; else editForm" [formGroup]="addResorceForm" nz-form [nzLayout]="'vertical'"
      (ngSubmit)="addResource()">
      <nz-form-item>
        <nz-form-label nz-row nzFor="resource">Resource <span class="redAstrics"> * </span>
        </nz-form-label>

        <nz-form-control nz-row nzErrorTip="Please select a Resource">
          <nz-select *ngIf="employees" formControlName="resource" nz-col nzSpan="24" nzShowSearch nzAllowClear
            nzPlaceHolder="Select a Resource">
            <nz-option *ngFor="let employee of employees" nzLabel="{{ employee.Name }}-{{ employee.Role }}"
              [nzValue]="employee"></nz-option>
          </nz-select>
        </nz-form-control>
      </nz-form-item>
      <nz-form-item>
        <nz-form-label nzFor="assignDate">Assigned Date
          <span class="redAstrics"> * </span>
        </nz-form-label>

        <nz-form-control class="mb-5">
          <nz-date-picker [nzDisabledDate]="disabledEndDate" [nzAllowClear] nzFormat="dd/MM/yyyy" formControlName="assignDate" nz-col nzSpan="12">
          </nz-date-picker>

          <span *ngIf="assignDateControl.invalid && assignDateControl.touched" class="error-block">
            <span *ngIf="assignDateControl.hasError('required')">
              Please enter resource Assigned Date
            </span>
            <span *ngIf="assignDateControl.errors?.invalidDate">
              Resource assigned date should not be less than Employee hire Date
            </span>
          </span>
        </nz-form-control>
      </nz-form-item>

      <div nz-row>
        <button type="submit"
          class="bg-green-500 hover:border-transparent hover:bg-green-600 text-white font-bold py-2 px-3 border border-green-500 mr-3">
          Add
        </button>

        <a class="text-green-500 border-1 border-green-500 border-solid bg-transparent font-semibold py-2 px-3 border hover:border-green-800 hover:text-green-800"
          (click)="resetForm()">
          Clear
        </a>
      </div>
    </form>
    <ng-template #editForm>
      <form [formGroup]="editResorceForm" nz-form [nzLayout]="'vertical'" (ngSubmit)="submitEditdValue()">
        <nz-form-item>
          <nz-form-label nz-row nzFor="resource">Resource <span class="redAstrics"> * </span>
          </nz-form-label>
          <nz-form-control nz-row nzErrorTip="Please select a Resource">
            <nz-select *ngIf="employees" formControlName="resource" nz-col nzSpan="24" nzShowSearch nzAllowClear
              nzPlaceHolder="Select a Resource">
              <nz-option *ngIf="asignedResourseToEdit" [nzValue]="asignedResourseToEdit?.Empolyee" nzLabel="{{ asignedResourseToEdit.Empolyee.Name }}-{{
                  asignedResourseToEdit.Empolyee.Role
                }}"></nz-option>
              <nz-option *ngFor="let employee of employees" nzLabel="{{ employee.Name }}-{{ employee.Role }}"
                [nzValue]="employee"></nz-option>
            </nz-select>
          </nz-form-control>
        </nz-form-item>

        <nz-form-item>
          <nz-form-label nzFor="assignDate">Assigned Date
            <span class="redAstrics"> * </span>
          </nz-form-label>
          <nz-form-control class="mb-5">
            <nz-date-picker [nzAllowClear] nzFormat="dd/MM/yyyy" formControlName="assignDate" nz-col nzSpan="12">
            </nz-date-picker>

            <span *ngIf="
                assignDateEditControl.invalid && assignDateEditControl.touched
              " class="error-block">
              <span *ngIf="assignDateControl.hasError('required')">
                Please input Assigned Date
              </span>
              <span *ngIf="assignDateEditControl.errors?.invalidDate">
                Project Assigned Should not be less than employee hired Date
              </span>
            </span>
          </nz-form-control>
        </nz-form-item>
        <div nz-row>
          <button *ngIf="!isOnEditstate" type="submit"
            class="bg-green-500 hover:border-transparent hover:bg-green-600 text-white font-bold py-2 px-3 border border-green-500 mr-3">
            Edit
          </button>

          <button *ngIf="isOnEditstate" [disabled]="disableUpdateButton"
            class=" font-semibold py-1   px-3 mr-3  border-white" type="submit"
            [ngClass]=" !disableUpdateButton ? 'bg-green-500  hover:bg-green-600  text-white':' cursor-not-allowed bg-gray-100  text-white ' ">
            Edit </button>


          <a class="text-green-500 border-1 border-green-500 border-solid bg-transparent font-semibold py-2 px-3 border hover:border-green-800 hover:text-green-800"
            (click)="resetEditForm()">
            Clear
          </a>
        </div>
      </form>
    </ng-template>
  </ng-container>
</nz-modal>



<nz-modal (nzOnCancel)="confirmCancel()"  [(nzVisible)]="removeResourceModel" [nzTitle]="confirmTile" [nzFooter]="null" [nzCentered]="true" [nzClosable]="true"
  nzClassName="conform-modal">

  <ng-template #confirmTile>
  
<i class="mr-2" style="color: coral;" nz-icon nzType="question-circle" nzTheme="outline"></i>   Resource unassign

 </ng-template>
 
  <ng-container *nzModalContent>
    <p> Are you sure to unassign project's resource ? </p>
    <span class="flex justify-end">
      <button  class="btn-cancel mr-8 " (click)="deleteCancel()">No</button>  
      <button  class="btn" (click)="removeResource()">Yes</button> 
    </span>
  </ng-container>
</nz-modal>

<nz-modal  *ngIf="isOnEditstate" (nzOnCancel)="confirmCancelExit()"  [(nzVisible)]="cancelModal"  [nzTitle]="confirmTile" [nzFooter]="null" [nzCentered]="true" [nzClosable]="true"
  nzClassName="conform-modal">

  <ng-template #confirmTile>
<i class="mr-2" style="color: coral;" nz-icon nzType="question-circle" nzTheme="outline"></i> Exit
 </ng-template>
  <ng-container *nzModalContent>
    <p > Are you sure to exit before updating project ? </p>
    <span class="flex justify-end">  
      <button  class="btn-cancel mr-8" (click)="rediretCancel()"> No </button>
      <button  class="btn" (click)="confimeresredirect()">Yes</button>
    </span>
  </ng-container>
</nz-modal>

